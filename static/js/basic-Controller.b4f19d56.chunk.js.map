{"version":3,"file":"static/js/basic-Controller.b4f19d56.chunk.js","mappings":"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","sources":["commons/ExternalAPIUtil.js","components/basic/Controller.js"],"sourcesContent":["export const getAdditionalAPIs = () => {\r\n    const OPENAI_API_KEY = \"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\";\r\n    const { Configuration, OpenAIApi } = require(\"openai\");\r\n    const configuration = new Configuration({\r\n        apiKey: OPENAI_API_KEY,\r\n    });\r\n    const openai = new OpenAIApi(configuration);\r\n\r\n    return {\r\n        openai\r\n    }\r\n}","import React, { useState, useRef, useEffect } from \"react\";\r\nimport wrapper from \"../../commons/WebComponentWrapper\";\r\nimport PubSub from 'pubsub-js';\r\nimport { getAdditionalAPIs } from \"../../commons/ExternalAPIUtil\";\r\n\r\nconst dispatchedEvents = [];\r\n\r\n/*\r\n    Example: <srs-controller handlers=[{eventName: \"XYZ\", type: \"script\", script: `(function(eventPayload) { console.log(eventPayload)})`}]/>\r\n*/\r\nconst SrsController = function (props, ref) {\r\n\r\n    const findElement = (key, nestedContents) => {\r\n        for (let element of nestedContents) {\r\n            if (element.elementId === key) {\r\n                return element;\r\n            } else if (element.children) {\r\n                const found = findElement(key, element.children);\r\n                if (found) return found;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    const getElement = (contents) => {\r\n        return (elementId) => {\r\n            let contentItems = contents ? [...contents] : [];\r\n            return findElement(elementId, contentItems);\r\n        }\r\n    }\r\n\r\n    const replaceElement = (elementId, elementObj, contentsToBeUpdated) => {\r\n        contentsToBeUpdated.forEach((element) => {\r\n            if (element.elementId === elementId) {\r\n                element = elementObj;\r\n            } else if (element.children) {\r\n                replaceElement(elementId, elementObj, element.children);\r\n            }\r\n        });\r\n    }\r\n\r\n    const setElement = (contents) => {\r\n        return (elementId, elementObj) => {\r\n            let contentsToBeUpdated = contents ? [...contents] : [];\r\n            replaceElement(elementId, elementObj, contentsToBeUpdated);\r\n            props.dispatchEvent(\"PAGE_CONTENTS_REFRESH\", { payload: contentsToBeUpdated });\r\n        }\r\n    }\r\n\r\n    const updateContents = (updatedClan) => {\r\n        props.dispatchEvent(\"PAGE_CONTENTS_REFRESH\", { payload: updatedClan });\r\n    }\r\n\r\n\r\n    useEffect(() => {\r\n        const tokens = [];\r\n\r\n        props.handlers && props.handlers.map((handler) => {\r\n            let token = PubSub.subscribe(handler.eventName, async (eventName, eventData) => {\r\n                if (handler.type) {\r\n                    switch (handler.type) {\r\n                        case \"script\":\r\n                            const context = {\r\n                                eventPayload: eventData?.data || {}, context: props.context || {}, clan: props.clan || [],\r\n                                dispatchEvent: props.dispatchEvent,\r\n                                api: {\r\n                                    getElement: getElement(props.clan),\r\n                                    setElement: setElement(props.clan),\r\n                                    updateContents,\r\n                                    ...getAdditionalAPIs()\r\n                                }\r\n                            };\r\n\r\n                            const scriptFn = new Function(...Object.keys(context), `return (${handler.script})();`);\r\n                            let scriptResult = await scriptFn(...Object.values(context));\r\n                            // console.log(scriptResult);\r\n                            if (scriptResult) {\r\n                                if (scriptResult.context) {\r\n                                    props.dispatchEvent(\"PAGE_CONTEXT_REFRESH\", { payload: scriptResult.context });\r\n                                }\r\n                                if (scriptResult.clan) {\r\n                                    props.dispatchEvent(\"PAGE_CONTENTS_REFRESH\", { payload: scriptResult.clan });\r\n                                }\r\n                            }\r\n                            break;\r\n                        case \"dispatch\":\r\n                            break;\r\n                        case \"navigate\":\r\n                            break;\r\n                    }\r\n                }\r\n\r\n            });\r\n            tokens.push(token);\r\n        })\r\n\r\n\r\n        return () => {\r\n            tokens.map(token => PubSub.unsubscribe(token));\r\n        };\r\n    }, [props]);\r\n\r\n    return (<div />);\r\n}\r\n\r\nconst styles = `\r\n`\r\nconst props = [{\r\n    name: \"handlers\",\r\n    defaultValue: [],\r\n    type: \"object\"\r\n}]\r\n\r\nconst slots = [];\r\n\r\nconst WrappedComponent = wrapper(React.forwardRef(SrsController), props);\r\nexport { WrappedComponent, styles, props, dispatchedEvents, slots };"],"names":["getAdditionalAPIs","_require","require","Configuration","openai","OpenAIApi","apiKey","dispatchedEvents","SrsController","props","ref","findElement","key","nestedContents","_step","_iterator","_createForOfIteratorHelper","s","n","done","element","value","elementId","children","found","err","e","f","getElement","contents","contentItems","_toConsumableArray","replaceElement","elementObj","contentsToBeUpdated","forEach","setElement","dispatchEvent","payload","updateContents","updatedClan","useEffect","tokens","handlers","map","handler","token","PubSub","eventName","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","eventData","context","scriptFn","scriptResult","wrap","_context","prev","next","type","t0","eventPayload","data","clan","api","_objectSpread","_construct","Function","Object","keys","concat","script","apply","values","sent","abrupt","stop","_x","_x2","arguments","push","_jsx","styles","name","defaultValue","slots","WrappedComponent","wrapper","React"],"sourceRoot":""}